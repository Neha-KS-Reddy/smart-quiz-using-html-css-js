<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pro Teacher Dashboard</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --accent: #0ea5e9;
      --bg-dark: #04111a;
      --bg-light: #0f1e2a;
      --card-bg: #0f1e2a;
      --text-light: #fff;
      --text-muted: #ccc;
      --pass-color: #22c55e;
      --fail-color: #ef4444;
    }

    body, html { margin:0; padding:0; font-family:"Segoe UI", sans-serif; background:var(--bg-dark); color:var(--text-light); }
    .sidebar { width:250px; height:100vh; position:fixed; top:0; left:0; background:var(--bg-light); display:flex; flex-direction:column; padding-top:20px; transition:width 0.3s; }
    .sidebar h2 { text-align:center; margin-bottom:30px; font-size:1.4rem; color:var(--accent); }
    .sidebar .menu-item { padding:12px 20px; cursor:pointer; display:flex; justify-content:space-between; align-items:center; color:var(--text-light); transition:background 0.3s; }
    .sidebar .menu-item:hover { background: rgba(14,165,233,0.2); }
    .sidebar .submenu { display:none; flex-direction:column; padding-left:20px; }
    .sidebar .submenu .subitem { padding:8px 0; cursor:pointer; font-size:0.9rem; color:var(--text-muted); }
    .sidebar .submenu .subitem:hover { color:var(--accent); }
    .main { margin-left:250px; padding:20px; }
    .cards { display:grid; grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:20px; margin-bottom:30px; }
    .card { background:var(--card-bg); padding:20px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,0.5); }
    .card h3 { margin:0 0 10px 0; font-size:1.2rem; color:var(--accent); }
    .card p { margin:0; font-size:1rem; }
    .dash-view { display:none; }
    .dash-view.active { display:block; }
    .list { list-style:none; padding:0; margin-top:15px; }
    .list li { background: var(--bg-light); margin-bottom:10px; padding:10px; border-radius:8px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; }
    .btn { background:var(--accent); color:var(--bg-dark); border:none; padding:5px 10px; border-radius:6px; cursor:pointer; transition: all 0.2s; }
    .btn:hover { opacity:0.8; }
    .btn.alt { background:#333; color:#fff; }
    .inline-form input, .inline-form select { padding:6px; margin-right:8px; border-radius:6px; border:1px solid #ccc; }
    .two-cols { display:flex; gap:10px; margin:8px 0; }
    .btn-row { display:flex; gap:10px; margin-top:10px; }
    .muted { color:var(--text-muted); font-size:0.9rem; }
    canvas { margin-top:20px; background:var(--bg-light); border-radius:12px; padding:10px; }
  </style>
</head>
<body>
  <div class="sidebar">
    <h2><i class="fa-solid fa-chalkboard-teacher"></i> Teacher</h2>

    <div class="menu-item" onclick="toggleMenu('catMenu')">
      <span><i class="fa-solid fa-folder-plus"></i> Categories</span>
      <i class="fa-solid fa-chevron-down"></i>
    </div>
    <div class="submenu" id="catMenu">
      <div class="subitem" onclick="showView('view-cats')">All Categories</div>
      <div class="subitem" onclick="showView('view-addq')">Add Question</div>
      <div class="subitem" onclick="showView('view-manageq')">Manage Questions</div>
    </div>

    <div class="menu-item" onclick="toggleMenu('studentMenu')">
      <span><i class="fa-solid fa-users"></i> Students</span>
      <i class="fa-solid fa-chevron-down"></i>
    </div>
    <div class="submenu" id="studentMenu">
      <div class="subitem" onclick="showView('view-students')">Manage Students</div>
    </div>

    <div class="menu-item" onclick="toggleMenu('resultMenu')">
      <span><i class="fa-solid fa-chart-line"></i> Submissions</span>
      <i class="fa-solid fa-chevron-down"></i>
    </div>
    <div class="submenu" id="resultMenu">
      <div class="subitem" onclick="showView('view-results')">View Submissions</div>
    </div>

    <div style="margin-top:auto; padding:20px;">
      <button class="btn" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i> Logout</button>
    </div>
  </div>

  <div class="main">
    <div class="cards">
      <div class="card"><h3>Total Categories</h3><p id="totalCats">0</p></div>
      <div class="card"><h3>Total Questions</h3><p id="totalQs">0</p></div>
      <div class="card"><h3>Total Students</h3><p id="totalStudents">0</p></div>
      <div class="card"><h3>Total Submissions</h3><p id="totalSubs">0</p></div>
    </div>

    <!-- Categories -->
    <div id="view-cats" class="dash-view">
      <section class="card">
        <h3><i class="fa-solid fa-folder-plus"></i> Categories</h3>
        <form onsubmit="addCategory(event)" class="inline-form">
          <input id="newCategory" placeholder="New category name" required />
          <button class="btn small" type="submit"><i class="fa-solid fa-plus"></i> Add</button>
        </form>
        <ul id="categoryList" class="list"></ul>
      </section>
    </div>

    <!-- Add Question -->
    <div id="view-addq" class="dash-view">
      <section class="card">
        <h3><i class="fa-solid fa-circle-question"></i> Add Question</h3>
        <form id="addQForm" onsubmit="addQuestion(event)">
          <input id="newQuestion" placeholder="Question text" required />
          <div class="two-cols">
            <input id="optionA" placeholder="Option A" required />
            <input id="optionB" placeholder="Option B" required />
          </div>
          <div class="two-cols">
            <input id="optionC" placeholder="Option C" required />
            <input id="optionD" placeholder="Option D" required />
          </div>
          <div class="two-cols">
            <input id="correct" placeholder="Correct (A/B/C/D)" required />
            <select id="category"></select>
          </div>
          <div class="btn-row">
            <button class="btn" type="submit"><i class="fa-solid fa-plus"></i> Add</button>
            <button class="btn alt" type="button" onclick="document.getElementById('addQForm').reset()">
              <i class="fa-solid fa-rotate-left"></i> Reset
            </button>
          </div>
        </form>
      </section>
    </div>

    <!-- Manage Questions -->
    <div id="view-manageq" class="dash-view">
      <section class="card">
        <h3><i class="fa-solid fa-list"></i> Manage Questions</h3>
        <ul id="questionList" class="list"></ul>
      </section>
    </div>

    <!-- Submissions -->
    <div id="view-results" class="dash-view">
      <section class="card">
        <h3><i class="fa-solid fa-chart-line"></i> Submissions</h3>
        <ul id="resultsList" class="list"></ul>
        <canvas id="resultsChart" width="400" height="200"></canvas>
      </section>
    </div>

    <!-- Students -->
    <div id="view-students" class="dash-view">
      <section class="card">
        <h3><i class="fa-solid fa-users"></i> Registered Students</h3>
        <ul id="studentList" class="list"></ul>
      </section>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="app.js"></script>
  <script>
    const views = document.querySelectorAll('.dash-view');

    function showView(id){
      views.forEach(v=>v.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      updateMetrics();
      if(id==='view-results') loadResults();
    }

    function toggleMenu(menuId){
      const menu=document.getElementById(menuId);
      menu.style.display = menu.style.display==='flex'?'none':'flex';
    }

    function updateMetrics(){
      document.getElementById('totalCats').innerText = getCategories().length;
      document.getElementById('totalQs').innerText = getQuestions().length;
      document.getElementById('totalStudents').innerText = getUsers().length;
      document.getElementById('totalSubs').innerText = getSubs().length;
    }

    function loadResults(){
      const subs = getSubs();
      const list = document.getElementById('resultsList');
      list.innerHTML='';
      const chartData = {};

      if(subs.length===0){
        list.innerHTML="<li class='muted'>No submissions yet</li>";
        return;
      }

      subs.slice().reverse().forEach((s, idx)=>{
        const status = s.score/s.total >=0.5 ? "Passed":"Failed";
        const when = new Date(s.time).toLocaleString();

        // For chart
        chartData[s.category] = chartData[s.category] || {Passed:0, Failed:0};
        chartData[s.category][status]++;

        list.innerHTML+=`<li>
          <div>
            <b>${s.user}</b> — ${s.category} — ${s.score}/${s.total} 
            <span style="color:${status==='Passed'? 'var(--pass-color)':'var(--fail-color)'}; font-weight:bold;">${status}</span>
            <small class="muted">${when}</small>
          </div>
          <button class="btn small alt" onclick="deleteSubmission(${subs.length-1-idx})">Delete</button>
        </li>`;
      });

      // Chart
      const ctx = document.getElementById('resultsChart').getContext('2d');
      const labels = Object.keys(chartData);
      const passedData = labels.map(l=>chartData[l].Passed);
      const failedData = labels.map(l=>chartData[l].Failed);

      if(window.resultsChart) window.resultsChart.destroy();
      window.resultsChart = new Chart(ctx,{
        type:'bar',
        data:{
          labels,
          datasets:[
            { label:'Passed', data:passedData, backgroundColor:'var(--pass-color)' },
            { label:'Failed', data:failedData, backgroundColor:'var(--fail-color)' }
          ]
        },
        options:{ responsive:true, plugins:{ legend:{ position:'top' } } }
      });
    }

    // Initial view
    showView('view-cats');
    updateMetrics();
  </script>
</body>
</html>
